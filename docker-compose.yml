services:
  # Official Signal CLI REST API
  signal-api:
    image: bbernhard/signal-cli-rest-api:latest
    container_name: signal-api
    environment:
      - MODE=json-rpc  # Fastest mode, keeps JVM running
    ports:
      - "127.0.0.1:8080:8080"    # Signal API - localhost only
    volumes:
      - ./signal-data:/home/.local/share/signal-cli
    restart: unless-stopped

  # SigAPI - Your Signal messaging API
  sigapi:
    build: ./wrapper
    container_name: sigapi
    environment:
      - NODE_ENV=production
      - SIGNAL_API_URL=http://signal-api:8080
      - PORT=3000
      - RATE_LIMIT_DELAY_MS=1000
      - SIGNAL_NUMBER=${SIGNAL_NUMBER}
    ports:
      - "127.0.0.1:3000:3000"    # SigAPI - localhost only
    volumes:
      - ./wrapper/logs:/app/logs
    depends_on:
      - signal-api
    restart: unless-stopped

volumes:
  signal-data:

